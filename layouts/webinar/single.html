{{ partial "head.html" . }}
<!-- NAVBAR -->
<body>
 {{ partial "header.html" . }}
 <!-- HEADING -->
 <div class="heading-default-single" style="background: url(/img/background/safespring-blue-fade2.svg); background-size: cover; background-position: center;">
   {{ .Render "li3" }}
 </div>
 <!-- CONTENT -->
 <div class="main-default-single">
  <div class="content-default-single">
{{ if .Params.videoURL }}
<div class="webinarvideo">
    <video id="player" class="webinar-videoplayer" poster="{{ .Params.thumbnail }}" controls playsinline webkit-playsinline>
        {{ if eq (path.Ext .Params.videoURL) ".m3u8" }}
            <!-- Inget behov av <source> taggen för .m3u8, hanteras av hls.js -->
        {{ else }}
            <source src="{{ .Params.videoURL }}" type="video/mp4">
        {{ end }}

        {{ range .Params.subtitles }}
            <track kind="subtitles" src="{{ .src }}" srclang="{{ .srclang }}" label="{{ .label }}">
        {{ end }}

        Your browser does not support the video tag..
    </video>
</div>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var video = document.getElementById('player');
        var videoSrc = "{{ .Params.videoURL }}";
        console.log("Video source:", videoSrc);

        if (Hls.isSupported()) {
            var hls = new Hls();

            // Lägg till en logg för varje huvudhändelse i HLS för att se hur långt vi kommer
            hls.on(Hls.Events.MEDIA_ATTACHED, function () {
                console.log('video and hls.js are now bound together!');
            });
            hls.on(Hls.Events.MANIFEST_PARSED, function () {
                console.log('manifest loaded, found ' + hls.levels.length + ' quality level');
                try {
                    video.play();
                } catch (e) {
                    console.error('Error trying to play video:', e);
                }
            });

            // Felsökning: lägg till detaljerade loggar för alla händelser och fel.
            hls.on(Hls.Events.ERROR, function (event, data) {
                if (data.fatal) {
                    switch (data.type) {
                        case Hls.ErrorTypes.NETWORK_ERROR:
                            console.error('fatal network error encountered', data);
                            break;
                        case Hls.ErrorTypes.MEDIA_ERROR:
                            console.error('fatal media error encountered', data);
                            break;
                        default:
                            console.error('fatal error encountered', data);
                            break;
                    }
                } else {
                    console.warn('non-fatal error', data);
                }
            });

            hls.loadSource(videoSrc);
            hls.attachMedia(video);
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = videoSrc;
            video.addEventListener('canplay', function() {
                try {
                    video.play();
                } catch (e) {
                    console.error('Error trying to play video:', e);
                }
            });
        } else {
            console.error('HLS is not supported on this device and the video cannot be played with native MPEGURL support.');
        }
    });
</script>
{{ end }}
          {{ .Content }}
          {{ partial "webinar-serie.html" . }}
        </div>
        <div class="sidebar-default-single">
          {{ if .Params.chapters }}
          <div class="sidebar-container">
            <div class="sidebar-content">
              <h3>{{ if .Params.chaptersTitle }}{{ .Params.chaptersTitle }}{{ else }}Avsnitt{{ end }}</h3>
              <div class="webinarplaylist">
                <ul>
                  {{ range $index, $element := .Params.chapters }}
                  <a href="javascript:void(0);" onclick="setCurrentTime({{ $element.time }})">
                    <li><span>{{ $element.title }}</span> <span class="timer">{{ $element.timeFormatted }}</span></li>
                  </a>
                  {{ end }}
                </ul>
              </div>
            </div>
          </div>
          {{ end }}
          {{ if .Params.sidebar }}{{ partial "sidebar-default-single.html" . }}{{ end }}
        </div>
      </div>
      <!-- SIDEBAR -->
      {{ partial "webinar-side-bar.html" . }}
    </main>
    <!-- FOOTER -->
    {{ partial "footer.html" . }}
    <script>
      var player = document.getElementById('player');
      function setCurrentTime(time) {
        player.currentTime = time;
        player.play();
      }
    </script>